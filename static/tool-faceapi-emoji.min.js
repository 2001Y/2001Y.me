let json,txt,size3;function emojiF(){emojiFixed.checked?(emoji.focus(),emoji.disabled=!1):(emoji.blur(),emoji.disabled=!0)}function sizeF(){sizeDouble.checked?(sizeDoubleNum.focus(),sizeDoubleNum.disabled=!1):(sizeDoubleNum.blur(),sizeDoubleNum.disabled=!1),sizeFixed.checked?(sizeFixedNum.focus(),sizeFixedNum.disabled=!1):(sizeFixedNum.blur(),sizeFixedNum.disabled=!1)}fetch("https://unpkg.com/unicode-emoji-json/data-ordered-emoji.json").then((function(e){return e.json()})).then((function(e){json=e})),emojiF(),sizeF();const MODEL_URL="/face-api/models/";let uploadImgSrc,file=document.getElementById("file"),canvas=document.getElementById("canvas"),canvasWidth=350,canvasHeight=350;var ctx=canvas.getContext("2d",{alpha:!1});function loadLocalImage(e){let t=e.target.files[0],a=document.createElement("style");a.innerHTML="#file:before { content: '"+t.name+"' !important }",document.body.appendChild(a);let i=new FileReader;i.onload=function(){uploadImgSrc=i.result,canvasDraw(t)},i.readAsDataURL(t)}function canvasDraw(){info.innerText=" - 準備中",ctx.clearRect(0,0,canvasWidth,canvasHeight);let e=new Image;e.src=uploadImgSrc,e.onload=function(){canvasWidth=this.naturalWidth,canvasHeight=this.naturalHeight,canvas.width=canvasWidth,canvas.height=canvasHeight,ctx.drawImage(e,0,0,canvasWidth,this.height*(canvasWidth/this.width)),getFaceData(e)}}function getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}async function getFaceData(e){await faceapi.nets.tinyFaceDetector.load(MODEL_URL),await faceapi.nets.faceLandmark68Net.load(MODEL_URL);const t=await faceapi.detectAllFaces(e,new faceapi.TinyFaceDetectorOptions).withFaceLandmarks();if(0==t.length)alert("人間じゃないよ");else for(let e=0;e<t.length;e++){let a=t[e].landmarks._positions;emojiRandom.checked&&(txt=json[getRandomInt(94)]),emojiFixed.checked&&(txt=emoji.value),sizeAuto.checked&&(size3=1.7*(a[9].y-a[28].y)+"px"),sizeDouble.checked&&(size3=1.7*(a[9].y-a[28].y)*sizeDoubleNum.value+"px"),sizeFixed.checked&&(size3=sizeFixedNum.value),ctx.font=size3+" Arial",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(txt,a[30].x,a[2].y),document.getElementById("download").href=canvas.toDataURL(),info.innerText=" - 完了"}}file.addEventListener("change",loadLocalImage,!1);